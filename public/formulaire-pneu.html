<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Formulaire R√©appro</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f4f8;
      margin: 0;
      padding: 10px;
    }

    .form-container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.05);
      max-width: 700px;
      margin: auto;
    }

    h2 {
      text-align: center;
      color: #1e90ff;
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
      color: #333;
    }

    input, select, textarea {
      width: 100%;
      padding: 5px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
    }
    .file-preview {
      margin-top: 10px;
    }
    .file-item {
      background: #f0f0f0;
      border-radius: 5px;
      margin-bottom: 8px;
      padding: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .file-item img {
      max-height: 40px;
      margin-right: 10px;
    }
    .file-item button {
      background: red;
      color: white;
      border: none;
      padding: 3px 6px;
      cursor: pointer;
    }
    .paste-zone {
      border: 2px dashed #aaa;
      padding: 15px;
      margin-top: 10px;
      border-radius: 6px;
      text-align: center;
      color: #555;
      background: #fafafa;
    }
    button[type="submit"] {
      margin-top: 20px;
      background: #007bff;
      color: white;
      border: none;
      padding: 12px;
      border-radius: 4px;
      cursor: pointer;
    }
  
    .actions{
      margin-top: 15px;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    .message-inline{
      margin: 0 !important;
      font-weight: bold;
      min-height: 1.2em;
    }
    .actions button[type="submit"]{ margin-top: 0 !important; }

  </style>
</head>
<body>
  <div class="form-container">
    <h2>üöó Formulaire cr√©ation Pneumatique VL / VUL üöó</h2>
  <form id="formulaire" enctype="multipart/form-data">
    <label>Votre Adresse e-mail</label>
    <input type="email" id="emailInput" name="email" list="emailsList" required />
    <datalist id="emailsList"></datalist>

    <label>Fournisseur de R√©appro</label>
    <input type="text" name="fournisseur" required />

    <label>EAN</label>
    <input type="text" name="ean" />

    <label>CAI</label>
    <input type="text" name="cai" />

    <label>Adh√©rence sol mouill√©</label>
    <input type="text" name="adherence" />

    <label>Consommation carburant</label>
    <input type="text" name="conso" />

    <label>Niveau sonore</label>
    <input type="text" name="sonore" />

    <label>Classe de performance</label>
    <input type="text" name="classe" />

    <label>D√©signation Pneu</label>
    <input type="text" name="designation" />

    <label>Prix BF</label>
    <input type="text" name="prixBF" />

    <label>Prix d'achat</label>
    <input type="text" name="prixAchat" />

    <label>Pi√®ces jointes</label>
    <input type="file" id="fileInput" multiple />
    
    <div class="paste-zone" id="pasteZone">
      üì∏ Vous pouvez aussi coller une capture d‚Äô√©cran avec <strong>Ctrl+V</strong>
    </div>

    <div class="file-preview" id="filePreview"></div>

    <div class="actions">
      <button type="submit">Envoyer</button>
      <div id="message" class="message-inline"></div>
    </div>
  </form>

  <script>
    const fileInput = document.getElementById("fileInput");
    const filePreview = document.getElementById("filePreview");
    const pasteZone = document.getElementById("pasteZone");
    const form = document.getElementById("formulaire");
    const messageEl = document.getElementById("message");

    const emailInput = document.getElementById("emailInput");
    const emailsList = document.getElementById("emailsList");
    const LS_KEY = "emails_history";

    (function fillEmailSuggestions() {
      const stored = JSON.parse(localStorage.getItem(LS_KEY) || "[]");
      stored.forEach(addr => {
        const opt = document.createElement("option");
        opt.value = addr;
        emailsList.appendChild(opt);
      });
      if (stored.length === 1) emailInput.value = stored[0];
    })();

    let files = [];

    fileInput.addEventListener("change", () => {
      for (const file of fileInput.files) {
        files.push(file);
      }
      updatePreview();
      fileInput.value = "";
    });

    pasteZone.addEventListener("paste", (event) => {
      const items = event.clipboardData.items;
      for (const item of items) {
        if (item.kind === "file") {
          const file = item.getAsFile();
          if (file) {
            files.push(file);
          }
        }
      }
      updatePreview();
    });

    function updatePreview() {
      filePreview.innerHTML = "";
      files.forEach((file, index) => {
        const div = document.createElement("div");
        div.className = "file-item";

        const isImage = file.type.startsWith("image/");
        const preview = isImage ? `<img src="${URL.createObjectURL(file)}" alt="image">` : "";

        div.innerHTML = `
          <div style="display:flex; align-items:center;">
            ${preview}
            <span>${file.name}</span>
          </div>
          <button type="button" onclick="removeFile(${index})">X</button>
        `;
        filePreview.appendChild(div);
      });
    }

    function removeFile(index) {
      files.splice(index, 1);
      updatePreview();
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
    

const submitBtn = form.querySelector('button[type="submit"]');
if (submitBtn && submitBtn.disabled) return;
if (submitBtn) {
  submitBtn.disabled = true;
  submitBtn.dataset.oldLabel = submitBtn.textContent;
  submitBtn.textContent = 'Envoi‚Ä¶';
}
const unlock = () => {
  if (!submitBtn) return;
  submitBtn.disabled = false;
  submitBtn.textContent = submitBtn.dataset.oldLabel || 'Envoyer';
};
if (files.length === 0) {
    messageEl.textContent = "‚ö†Ô∏è Veuillez ajouter au moins une capture d‚Äô√©cran ou un fichier.";
    messageEl.style.color = "orange";
    unlock();
    return;}
      messageEl.textContent = "‚è≥ Envoi en cours...";
      messageEl.style.color = "black";

      const formData = new FormData(form);
      files.forEach(file => formData.append("fichiers[]", file));

      try {
        const response = await fetch(
  "https://mes-formulaires.onrender.com/formulaire-pneu/submit-form",
  { method: "POST", body: formData }
);

        if (response.ok) {
          messageEl.textContent = "‚úÖ Formulaire envoy√© avec succ√®s !";
          messageEl.style.color = "green";
          form.reset();
          files = [];
          updatePreview();
        } else {
          messageEl.textContent = "‚ùå Une erreur est survenue lors de l'envoi.";
          messageEl.style.color = "red";
        }
      } catch (error) {
        messageEl.textContent = "‚ùå Erreur r√©seau ou serveur.";
        messageEl.style.color = "red";
      }
      finally {
        unlock();
      }
    });
  </script>
</body>