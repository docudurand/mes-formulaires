<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Liens Formulaire Garantie et Retour PL</title>

  <link rel="stylesheet" href="../assets/style.css" />
  <link rel="icon" href="/assets/icons/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#e9efff">

  <style>
    .page-title{
      text-align:center;
      font-size: clamp(22px, 2.2vw, 34px);
      font-weight: 900;
      letter-spacing:.5px;
      margin: 10px 0 18px;
      color:#1d2336;
      text-transform: uppercase;
    }

    .links{
      max-width: 1050px;
      margin: 0 auto;
      display:grid;
      gap:12px;
    }
    .link-card{
      background:#fff;
      border:1px solid #dfe5f5;
      border-radius:14px;
      padding:14px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .link-label{
      font-weight:900;
      letter-spacing:.2px;
    }
    .link-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .btn{
      appearance:none;
      border:0;
      border-radius:999px;
      padding:10px 14px;
      font-weight:900;
      cursor:pointer;
      background:#1e2f57;
      color:#fff;
      box-shadow:0 8px 18px rgba(0,0,0,.12);
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }
    .btn.secondary{ background:#6a748f; }
    .err{
      display:none;
      margin-top:12px;
      color:#b00020;
      font-weight:900;
      text-align:center;
    }
  </style>
</head>

<body>
<header class="topbar">
  <div class="brand-left">
    <a href="/index.html" class="brand-link" aria-label="Retour à l'accueil">
      <img src="https://raw.githubusercontent.com/docudurand/mes-formulaires/main/logo2.png" alt="Documents Durand">
    </a>
  </div>

  <nav class="nav" aria-label="Menus">
    <div class="menu" data-menu="pl">
      <button class="menu-btn is-active" type="button">MENU PL</button>
      <div class="dropdown" role="menu" aria-label="Menu PL">
        <a href="../pl/formulaire-creation-reference-pl.html" role="menuitem">FORMULAIRE CREATION REFERENCE PL</a>
        <a href="../pl/fournisseur-pl.html" role="menuitem">FOURNISSEUR PL</a>
        <a href="../pl/liens-garantie-retour-pl.html" role="menuitem">LIENS FORMULAIRE GARANTIE ET RETOUR PL</a>
      </div>
    </div>

    <div class="menu" data-menu="vl">
      <button class="menu-btn" type="button">MENU VL</button>
      <div class="dropdown" role="menu" aria-label="Menu VL">
        <a href="../vl/contact-fournisseur.html" role="menuitem">CONTACT FOURNISSEURS</a>
        <a href="../vl/retour-fournisseur-garantie-vl.html" role="menuitem">RETOUR FOURNISSEUR ET GARANTIE VL</a>
      </div>
    </div>

    <a class="menu-btn" href="/utilitaire/index.html">UTILITAIRE</a>
    <a class="menu-btn" href="/atelier/index.html">ATELIER</a>
    <a class="menu-btn" href="/gestion-garantie/index.html">GESTION GARANTIE</a>
  </nav>

  <div class="brand-right">
    <img src="https://raw.githubusercontent.com/docudurand/mes-formulaires/main/logod.png" alt="D" style="height:34px;">
  </div>
</header>

<main class="wrap">
  <section class="card">
    <div class="content">
      <div class="page-title">LIENS FORMULAIRE GARANTIE ET RETOUR PL</div>

      <div class="links" id="linksList"></div>

      <div id="linksErr" class="err">❌ Impossible de charger les liens.</div>
    </div>
  </section>
</main>

<script>
  window.__SITE_PREFIX__ = "../";
</script>
<script src="../assets/auth.js"></script>
<script>requireAuth();</script>
<script src="../assets/app.js"></script>

<script>
(function(){
  const API_URL = "/api/pl/liens-garantie-retour";
  const listEl = document.getElementById("linksList");
  const errEl  = document.getElementById("linksErr");

  function esc(s){
    return String(s ?? "")
      .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
      .replaceAll('"',"&quot;").replaceAll("'","&#039;");
  }

  function normalizeItem(x){
    if (!x) return null;

    const label = (x.label ?? x.title ?? x.name ?? "").toString().trim();
    const url   = (x.url ?? x.href ?? "").toString().trim();
    if (!label || !url) return null;
    return { label, url };
  }

  function render(items){
    listEl.innerHTML = "";
    for (const it of items){
      const card = document.createElement("div");
      card.className = "link-card";
      card.innerHTML = `
        <div class="link-label">${esc(it.label)}</div>
        <div class="link-actions">
          <a class="btn" href="${esc(it.url)}" target="_blank" rel="noopener">Ouvrir</a>
          <button class="btn secondary" type="button" data-copy="${esc(it.url)}">Copier</button>
        </div>
      `;
      listEl.appendChild(card);
    }

    listEl.querySelectorAll("button[data-copy]").forEach(btn=>{
      btn.addEventListener("click", async ()=>{
        const url = btn.getAttribute("data-copy") || "";
        try{
          await navigator.clipboard.writeText(url);
          const old = btn.textContent;
          btn.textContent = "✅ Copié";
          setTimeout(()=>btn.textContent = old, 900);
        }catch{
          alert("Impossible de copier automatiquement. Voici le lien :\n\n" + url);
        }
      });
    });
  }

  async function load(){
    errEl.style.display = "none";
    try{
      const r = await fetch(API_URL, { cache:"no-store" });
      if (!r.ok) throw new Error("HTTP " + r.status);
      const data = await r.json();

      const arr = Array.isArray(data) ? data : (Array.isArray(data?.links) ? data.links : []);
      const items = arr.map(normalizeItem).filter(Boolean);

      render(items);
    }catch(e){
      console.error(e);
      errEl.style.display = "block";
    }
  }

  load();
})();
</script>
</body>
</html>
